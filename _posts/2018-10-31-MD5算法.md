---
layout: post
title: "MD5 算法"
categories: [Algorithm]
description:
keywords:
---

* content
{:toc} 

## 简介

在网络传输中, 为了网络传输安全所做的[信息摘要]签名, 签名通常是用[MD5算法]来生成的, 例如转账功能中我们的产品向第三方支付平台发起支付请求, 金额是 1 元, 目标账户是 1234, 但网络传输并非安全的, 一旦传输过程中被坏人拦截了, 就会造成信息被篡改, 金额是 100 元, 目标账户是 5678, 对用户造成损失, 这种时候就需要信息摘要技术了, **信息摘要把明文内容按照某种规则生成一段哈希值, 即时明文消息只改动一点点, 生成的结果也会完全不同. MD5就是信息摘要的一种实现, 它可以从任意长度的明文字符串生成 128 位的哈希值.**

## 使用信息摘要通信的过程

摘要哈希生成的正确姿势是什么样呢? 分三步：

1. 收集相关业务参数, 在这里是金额和目标账户. 当然, 实际应用中的参数肯定比这多得多, 这里只是做了简化. 

1. 按照规则, 把参数名和参数值拼接成一个字符串, 同时把给定的密钥也拼接起来. 之所以需要密钥, 是因为攻击者也可能获知拼接规则. 

1. 利用 MD5 算法, 从原文生成哈希值. MD5 生成的哈希值是 128 位的二进制数, 也就是32位的十六进制数. 

第三方支付平台如何验证请求的签名? 同样分三步：

1. 发送方和接收方**约定相同的字符串拼接规则, 约定相同的密钥. **

1. 第三方平台接到支付请求, 按规则拼接业务参数和密钥, 利用 MD5 算法生成 Sign. 

1. 用第三方平台自己生成的 Sign 和请求发送过来的 Sign 做对比, 如果两个 Sign 值一模一样, 则签名无误, 如果两个 Sign 值不同, 则信息做了篡改. 这个过程叫做验签. 

## 破解MD5

* MD5 算法有很多种方法可以破解, 但要明确一点, 这里所谓的破解并非把摘要还原成原文, 因为固定的 128 位的摘要是有穷的, 而原文的数量是无穷的, 每一个摘要都可以由若干个原文通过Hash得到, **对于 MD5 破解都属于[碰撞], ** 比如原文 A 通过 MD5可以生成摘要 M, 我们并不需要把 M 还原成 A, 只要找到原文 B, 生成同样的摘要 M 即可.

        设MD5的哈希函数是H（X）,那么：
        
        H(A) = M
        
        H(B) = M
        
        任意一个B即为破解结果. 
        
        B有可能等于A,也可能不等于A. 

* MD5 碰撞通常用于登陆密码的破解. 应用系统的数据库中存储的用户密码通常都是原密码的 MD5 哈希值, 每当用户登录时, 验签过程如下:

    1. 用户输入账号密码
    
        Username: ABC
        
        Password: 123456
        
    1. MD5(123456)与数据库中的数据比对

    如果我们得到了用户 ABC 的密码哈希值 E10ADC3949BA59ABBE56E057F20F883E, 并不需要还原出原密码 123456, 只需要“碰撞”出另一个原文 654321(只是举例)即可. 登录时, 完全可以使用 654321 作为登陆密码, 欺骗过应用系统的验签. 

* 破解方法

    1. 暴力枚举法

        顾名思义, 就是简单粗暴地枚举出所有原文, 并计算出他们的哈希值, 看看哪个哈希值和给定的哈希值一致, 这种方法虽然简单, 但是时间复杂度极高, 试想一下, 仅仅长度8位的密码就有多少种排列组合的可能, 如果只考虑大小写字母和数字, 每一位有 62 种可能, 62 的 8 次方, 约等于二百万亿

    1. 字典法

        暴力枚举法是时间换空间, 那么字典法则是用空间换时间, 黑客利用一个巨大的字典, 存储尽可能多的原文和对应的哈希值, 每次用给定的信息摘要查找字典, 即可快速找到碰撞的结果, 仍然以 8 位密码距离, 需要多大的空间呢? 每一对映射占用192(128 + 64)bit, 192 * 二百万亿约等于 4.65PB 的空间

    1. 彩虹表法

        彩虹表方法可以做到时间和空间均衡

        详见 [https://mp.weixin.qq.com/s/fLwwu9Ol21SfMRBzA_OyQg](https://mp.weixin.qq.com/s/fLwwu9Ol21SfMRBzA_OyQg)
